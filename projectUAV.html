<!DOCTYPE html>
<html>

<head>

    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css">

    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>

    <link rel="stylesheet" href="css/styles.css">

</head>

<body>

    <div id="map"></div>

    <script>
        var xhr = new XMLHttpRequest();
        xhr.open('GET', fileurl, true);
        xhr.responseType = 'arraybuffer';
        xhr.send();

        xhr.onload = function(e) {
            if (this.status == 200) {
                elevBuffer = this.response;
            } else {
                // handle errors here
            }
        }

        function getElevation(lat, lng, elevBuffer) {

            // resolution of dataset, 1 arc second here
            var resolution = 0.00027778;
            var hgtGridSize = 3601;

            return elevationFromlatlng(lat, lng);

            function wgs84ToPixel(lat, lng) {
                var y = Math.floor((1 - (lat % 1)) * (hgtGridSize));
                var x = Math.ceil((lng % 1) * (hgtGridSize));
                var px = (y * (hgtGridSize) * 2) + (x * 2);
                return px;
            }

            function elevationFromlatlng(lat, lng) {
                var elevation;
                var pixel = wgs84ToPixel(lat, lng);

                var g = new DataView(elevBuffer, pixel, 2);

                elevation = g.getInt16(0, false);
                return elevation;
            }

        }

        var map = L.map('map').setView([47.486153, 8.206813], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            'attribution': 'Kartendaten &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> Mitwirkende',
            'useCache': true
        }).addTo(map);

        var popup = L.popup();

        function onMapClick(e) {
            popup
                .setLatLng(e.latlng)
                .setContent("You clicked the map at " + e.latlng.toString())
                .openOn(map);
        }

        map.on('click', onMapClick);

    </script>

</body>

</html>
